---
phase: 05-cfb-features
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - apps/desktop/src/lib/draft-service.ts
  - apps/desktop/src/store/draft-store.ts
  - apps/desktop/src/store/index.ts
  - apps/desktop/src/pages/DraftTrackerPage.tsx
  - apps/desktop/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can log an NFL Draft pick with player name, position, round, pick number, and NFL team"
    - "User can optionally link a draft pick to an existing Player record"
    - "User can view historical draft class totals grouped by year with position breakdown"
    - "User can click a linked player to navigate to their Player Profile page"
    - "Draft tracker features are hidden for Madden dynasties"
  artifacts:
    - path: "apps/desktop/src/lib/draft-service.ts"
      provides: "CRUD for draft picks with position grouping logic"
      exports: ["createDraftPick", "getDraftPicksByDynasty", "getDraftPicksBySeason", "deleteDraftPick", "getPositionBreakdown"]
    - path: "apps/desktop/src/store/draft-store.ts"
      provides: "Zustand store for draft state"
      exports: ["useDraftStore"]
    - path: "apps/desktop/src/pages/DraftTrackerPage.tsx"
      provides: "Draft class entry, historical view by year, position breakdown, player profile links"
  key_links:
    - from: "apps/desktop/src/lib/draft-service.ts"
      to: "@dynasty-os/db"
      via: "db.draftPicks"
      pattern: "db\\.draftPicks"
    - from: "apps/desktop/src/pages/DraftTrackerPage.tsx"
      to: "navigation-store.ts"
      via: "goToPlayerProfile(playerId) for linked players"
      pattern: "goToPlayerProfile"
    - from: "apps/desktop/src/store/draft-store.ts"
      to: "draft-service.ts"
      via: "service function calls"
      pattern: "import.*draft-service"
---

<objective>
Build the NFL Draft tracker — service layer for logging draft picks, Zustand store, and a Draft Tracker page with draft class entry, historical view grouped by year, position breakdown counts, and links to player career records.

Purpose: Tracking which players get drafted and where they go is a core measure of program success. Linking draft picks back to player records creates a complete career narrative from recruit to NFL.

Output: Draft service with CRUD + position grouping, Zustand store, DraftTrackerPage with entry form, year-grouped history, position breakdown, and player profile navigation.
</objective>

<execution_context>
@/Users/chanmoore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chanmoore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-cfb-features/05-01-SUMMARY.md

@packages/core-types/src/draft.ts
@packages/db/src/dynasty-db.ts
@apps/desktop/src/lib/player-service.ts
@apps/desktop/src/store/navigation-store.ts
@apps/desktop/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Draft service and store</name>
  <files>
    apps/desktop/src/lib/draft-service.ts
    apps/desktop/src/store/draft-store.ts
    apps/desktop/src/store/index.ts
  </files>
  <action>
  1. Create `apps/desktop/src/lib/draft-service.ts`:
     - Import db from @dynasty-os/db, DraftPick from @dynasty-os/core-types, generateId from ./uuid.
     - CRUD functions:
       - `createDraftPick(input: Omit<DraftPick, 'id' | 'createdAt' | 'updatedAt'>)` — add timestamps, generateId, db.draftPicks.add(), return the pick
       - `getDraftPicksByDynasty(dynastyId: string)` — db.draftPicks.where('dynastyId').equals(dynastyId).toArray(), sort by year desc then round asc then pickNumber asc
       - `getDraftPicksBySeason(seasonId: string)` — db.draftPicks.where('seasonId').equals(seasonId).toArray(), sort by round asc then pickNumber asc
       - `deleteDraftPick(id: string)` — db.draftPicks.delete(id)
     - Position breakdown helper (pure function, exported):
       - `getPositionBreakdown(picks: DraftPick[]): Record<string, number>`
       - Group positions into standard groups: { QB: ['QB'], RB: ['RB', 'FB'], 'WR/TE': ['WR', 'TE'], OL: ['OT', 'OG', 'C', 'OL'], DL: ['DE', 'DT', 'DL', 'NT'], LB: ['LB', 'ILB', 'OLB', 'MLB'], DB: ['CB', 'S', 'FS', 'SS', 'DB'], 'K/P': ['K', 'P'] }
       - For each pick, find which group the position belongs to (case-insensitive match). If no group found, put in "Other".
       - Return counts per group, only include groups with count > 0.

  2. Create `apps/desktop/src/store/draft-store.ts`:
     - Zustand store with state: picks: DraftPick[], loading: boolean
     - Actions:
       - `loadPicks(dynastyId: string)` — calls getDraftPicksByDynasty, sets picks
       - `addPick(input, dynastyId)` — calls createDraftPick, then loadPicks(dynastyId)
       - `removePick(id, dynastyId)` — calls deleteDraftPick, then loadPicks(dynastyId)

  3. Update `apps/desktop/src/store/index.ts` — add:
     ```ts
     export { useDraftStore } from './draft-store';
     ```
  </action>
  <verify>Run `cd /Users/chanmoore/dev/dynasty-os && pnpm turbo build --filter=desktop` — must compile with no type errors.</verify>
  <done>Draft service has CRUD + position breakdown grouping. Store manages picks state with load/add/remove. Store exported from barrel.</done>
</task>

<task type="auto">
  <name>Task 2: Draft Tracker page and App.tsx routing</name>
  <files>
    apps/desktop/src/pages/DraftTrackerPage.tsx
    apps/desktop/src/App.tsx
  </files>
  <action>
  1. Create `apps/desktop/src/pages/DraftTrackerPage.tsx`:
     - Import useDraftStore, useDynastyStore, useSeasonStore, usePlayerStore, useNavigationStore, getPositionBreakdown from draft-service.
     - CFB-only guard: if activeDynasty.sport !== 'cfb', show "NFL Draft Tracker is only available for College Football dynasties." with back button.
     - Layout: dark theme (bg-gray-900 text-white), header with "NFL Draft Tracker" title, back button (goToDashboard).
     - Load picks on mount: useDraftStore loadPicks(activeDynasty.id).
     - Load players on mount: usePlayerStore for player linking dropdown.
     - **Add Draft Pick form** (top section):
       - Fields: playerName (text input), position (text input), round (1-7 select dropdown), pickNumber (optional number input), nflTeam (text input), seasonId (dropdown of dynasty seasons from useSeasonStore), playerId (optional — dropdown of players from usePlayerStore, with "— No link —" default option showing player names).
       - When a player is selected from the dropdown, auto-fill playerName and position from that player's data.
       - Submit calls addPick with the form data + dynastyId + year (derived from selected season).
       - Form clears after submission.
     - **Historical draft classes** (main content):
       - Group all picks by year (useMemo). Display each year as a section with year header and pick count.
       - Within each year section:
         - Table: columns Round, Pick #, Player, Position, NFL Team. Sort by round asc, pickNumber asc.
         - Player column: if pick.playerId is set, render player name as a clickable link (text-blue-400 hover:underline cursor-pointer) that calls goToPlayerProfile(pick.playerId). Otherwise render plain text.
         - Delete button (X icon) per row.
       - Position breakdown panel below each year's table: show getPositionBreakdown results as badges (e.g., "QB: 1", "WR/TE: 3", "DB: 2") in a flex-wrap row. Use muted background badges (bg-gray-700 text-gray-300 px-2 py-1 rounded text-xs).
     - Years sorted descending (newest first).

  2. Update `apps/desktop/src/App.tsx`:
     - Import DraftTrackerPage.
     - Add case 'draft-tracker': return <DraftTrackerPage /> to the switch.
  </action>
  <verify>Run `cd /Users/chanmoore/dev/dynasty-os && pnpm turbo build` — full build passes. Verify App.tsx switch has 'draft-tracker' case. Verify DraftTrackerPage imports goToPlayerProfile from navigation store.</verify>
  <done>DraftTrackerPage shows add-pick form with player linking, historical draft classes grouped by year, position breakdown badges, and clickable player links to profile pages. App.tsx routes to DraftTrackerPage. CFB-only guard active.</done>
</task>

</tasks>

<verification>
1. `pnpm turbo build` passes with no errors
2. Draft service exports CRUD + getPositionBreakdown
3. DraftTrackerPage has CFB-only guard
4. Draft picks are grouped by year in descending order
5. Linked players have clickable links that navigate to PlayerProfilePage
6. Position breakdown shows counts per position group
7. App.tsx routes 'draft-tracker' to DraftTrackerPage
</verification>

<success_criteria>
- User can log draft picks with player name, position, round, pick number, NFL team
- User can optionally link a draft pick to an existing Player record
- Historical view shows picks grouped by year with position breakdown
- Clicking a linked player name navigates to their Player Profile page
- CFB-only guard prevents Madden dynasties from accessing this feature
- Full build compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-cfb-features/05-03-SUMMARY.md`
</output>
