---
phase: 12-community-features
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/desktop/src/lib/coaching-staff-service.ts
  - apps/desktop/src/store/coaching-staff-store.ts
  - apps/desktop/src/pages/CoachingStaffPage.tsx
  - apps/desktop/src/store/navigation-store.ts
  - apps/desktop/src/App.tsx
  - apps/desktop/src/components/CommandPalette.tsx
autonomous: true
requirements:
  - COMM-01

must_haves:
  truths:
    - "User can hire a new coach with name, role, hire year, and scheme notes"
    - "User can fire a coach by recording a fire year (record preserved in history)"
    - "User can promote a coach by updating their role"
    - "Staff list shows current staff (no fire year) and history (fired) in separate sections"
    - "Delete and fire operations are undoable via useUndoStore and confirmed via toast"
  artifacts:
    - path: "apps/desktop/src/lib/coaching-staff-service.ts"
      provides: "Dexie CRUD for CoachingStaff table"
      exports:
        - createCoach
        - getCoachingStaffByDynasty
        - fireCoach
        - updateCoach
        - deleteCoach
    - path: "apps/desktop/src/store/coaching-staff-store.ts"
      provides: "Zustand store with load/add/fire/remove actions"
      exports:
        - useCoachingStaffStore
    - path: "apps/desktop/src/pages/CoachingStaffPage.tsx"
      provides: "Hire/fire/promote UI"
      min_lines: 80
    - path: "apps/desktop/src/store/navigation-store.ts"
      provides: "coaching-staff page entry + goToCoachingStaff action"
      contains: "coaching-staff"
    - path: "apps/desktop/src/App.tsx"
      provides: "case 'coaching-staff' in PageContent switch"
      contains: "coaching-staff"
    - path: "apps/desktop/src/components/CommandPalette.tsx"
      provides: "Coaching Staff command palette entry (sport-agnostic)"
      contains: "coaching-staff"
  key_links:
    - from: "apps/desktop/src/pages/CoachingStaffPage.tsx"
      to: "apps/desktop/src/store/coaching-staff-store.ts"
      via: "useCoachingStaffStore hook"
      pattern: "useCoachingStaffStore"
    - from: "apps/desktop/src/store/coaching-staff-store.ts"
      to: "apps/desktop/src/lib/coaching-staff-service.ts"
      via: "direct service function calls"
      pattern: "getCoachingStaffByDynasty|createCoach|fireCoach|deleteCoach"
---

<objective>
Build the Coaching Staff lifecycle feature: service layer, Zustand store, full hire/fire/promote UI page, and complete navigation registration.

Purpose: Dynasty managers need to track their coaching staff over the full program arc — who was hired, who was promoted, who was fired and when.
Output: CoachingStaffPage.tsx with service + store + 4-point navigation registration (navigation-store, App.tsx, CommandPalette).
</objective>

<execution_context>
@/Users/chanmoore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chanmoore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-community-features/12-RESEARCH.md

@apps/desktop/src/lib/rivalry-service.ts
@apps/desktop/src/store/rivalry-store.ts
@apps/desktop/src/store/navigation-store.ts
@apps/desktop/src/App.tsx
@apps/desktop/src/components/CommandPalette.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Coaching Staff service + store</name>
  <files>
    apps/desktop/src/lib/coaching-staff-service.ts
    apps/desktop/src/store/coaching-staff-store.ts
  </files>
  <action>
Create `apps/desktop/src/lib/coaching-staff-service.ts` following the rivalry-service.ts pattern exactly:

```typescript
import { db } from '@dynasty-os/db';
import type { CoachingStaff } from '@dynasty-os/core-types';
import { generateId } from './uuid';

export async function createCoach(
  input: Omit<CoachingStaff, 'id' | 'createdAt' | 'updatedAt'>
): Promise<CoachingStaff>

export async function getCoachingStaffByDynasty(dynastyId: string): Promise<CoachingStaff[]>
  // sorted: active staff (no fireYear) first, then fired sorted by fireYear desc

export async function fireCoach(id: string, fireYear: number): Promise<void>
  // db.coachingStaff.update(id, { fireYear, updatedAt: Date.now() })

export async function updateCoach(
  id: string,
  updates: Partial<Pick<CoachingStaff, 'role' | 'schemeNotes' | 'hireYear'>>
): Promise<void>

export async function deleteCoach(id: string): Promise<void>
```

Create `apps/desktop/src/store/coaching-staff-store.ts` following the rivalry-store.ts/game-store.ts Zustand pattern:

- State: `staff: CoachingStaff[]`, `loading: boolean`
- Actions: `loadStaff(dynastyId)`, `addCoach(input, dynastyId)`, `removeCoach(id, dynastyId)`, `fireCoach(id, fireYear, dynastyId)`, `promoteCoach(id, newRole, dynastyId)`
- Every mutation: call `useToastStore.getState().success(...)` on success, `.error(...)` on catch
- `removeCoach` and `fireCoach`: call `useUndoStore.getState().pushUndo(...)` before the DB op with table `'coachingStaff'`, operation `'delete'` or `'update'`, snapshot of current record. Use `as unknown as Record<string,unknown>` double-cast for TypeScript strict mode (see STATE.md Phase 11-01 decision).
- After every mutation: call `loadStaff(dynastyId)` to re-sync from DB
  </action>
  <verify>
    <automated>cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | tail -5</automated>
    <manual>TypeScript compiles without errors; coaching-staff-service.ts and coaching-staff-store.ts exist with correct exports</manual>
  </verify>
  <done>Both files exist, TypeScript compiles clean, service exports createCoach/getCoachingStaffByDynasty/fireCoach/updateCoach/deleteCoach, store exports useCoachingStaffStore with load/add/remove/fire/promote actions</done>
</task>

<task type="auto">
  <name>Task 2: CoachingStaffPage + navigation registration</name>
  <files>
    apps/desktop/src/pages/CoachingStaffPage.tsx
    apps/desktop/src/store/navigation-store.ts
    apps/desktop/src/App.tsx
    apps/desktop/src/components/CommandPalette.tsx
  </files>
  <action>
Create `apps/desktop/src/pages/CoachingStaffPage.tsx`:

- Layout: standard page header ("Coaching Staff") + two-panel layout with "Add Coach" form on the left and staff list on the right (same responsive grid pattern as other pages: `lg:grid-cols-2`)
- Sport guard: NONE — coaching staff is sport-agnostic
- On mount: `loadStaff(activeDynasty.id)` via useCoachingStaffStore
- "Active Staff" section: table/list showing coaches where `fireYear` is undefined/null — columns: Name, Role, Hire Year, Scheme Notes, action buttons (Fire, Promote, Delete)
- "Staff History" section (collapsible or below): coaches with `fireYear` set — columns: Name, Role, Hire Year, Fire Year
- Add Coach form fields: name (text), role (select: Head Coach | Offensive Coordinator | Defensive Coordinator | Special Teams | Recruiting Coordinator | Position Coach), hireYear (number, current year default), schemeNotes (textarea, optional)
- "Fire" button: prompts for fireYear (simple inline input or modal), then calls `store.fireCoach(id, year, dynastyId)` — sets fireYear, moves to history
- "Promote" button: opens inline role selector, calls `store.promoteCoach(id, newRole, dynastyId)`
- "Delete" button: calls `store.removeCoach(id, dynastyId)` — triggers undo push in store
- Tailwind styling: dark-mode gray-900/800 palette, consistent with other pages

Update `apps/desktop/src/store/navigation-store.ts`:
- Add `'coaching-staff'` to `Page` union type
- Add `goToCoachingStaff: () => void` to `NavigationActions` interface
- Implement `goToCoachingStaff: () => set({ currentPage: 'coaching-staff', pageParams: {} })`

Update `apps/desktop/src/App.tsx`:
- Import `CoachingStaffPage` from `./pages/CoachingStaffPage`
- Add `case 'coaching-staff': return <CoachingStaffPage />;` in the PageContent switch

Update `apps/desktop/src/components/CommandPalette.tsx`:
- Add entry to items array: `{ id: 'nav-coaching-staff', label: 'Coaching Staff', description: 'Manage coaching staff', group: 'Navigation', action: () => goToCoachingStaff() }`
- No sport guard for this item (coaching staff is sport-agnostic)
- Import goToCoachingStaff from useNavigationStore
  </action>
  <verify>
    <automated>cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | tail -5</automated>
    <manual>Navigate to Coaching Staff via CommandPalette (Cmd+K → "coaching staff"); verify page renders with Add Coach form and empty staff list</manual>
  </verify>
  <done>CoachingStaffPage renders via navigation; App.tsx switch case routes correctly; Page union has 'coaching-staff'; CommandPalette shows the entry; build exits 0</done>
</task>

</tasks>

<verification>
cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | grep -E "(error|warning|✓|built)" | tail -10
</verification>

<success_criteria>
- coaching-staff-service.ts exists with 5 exports
- coaching-staff-store.ts exports useCoachingStaffStore with 5 actions
- CoachingStaffPage.tsx renders hire/fire/promote UI with active staff + history sections
- navigation-store.ts Page union includes 'coaching-staff' and goToCoachingStaff action
- App.tsx has case 'coaching-staff'
- CommandPalette.tsx has coaching staff navigation entry
- pnpm build exits 0
</success_criteria>

<output>
After completion, create `.planning/phases/12-community-features/12-01-SUMMARY.md`
</output>
