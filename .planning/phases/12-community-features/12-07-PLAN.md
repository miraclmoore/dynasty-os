---
phase: 12-community-features
plan: "07"
type: execute
wave: 2
depends_on:
  - "12-01"
  - "12-02"
  - "12-03"
  - "12-04"
  - "12-05"
  - "12-06"
files_modified: []
autonomous: false
requirements:
  - COMM-01
  - COMM-02
  - COMM-03
  - COMM-04
  - COMM-05
  - COMM-06
  - COMM-07
  - COMM-08
  - COMM-09
  - COMM-10

must_haves:
  truths:
    - "All 10 COMM requirements are visually verified as working in the running app"
    - "Build exits 0 with no TypeScript errors"
    - "Sport guards prevent CFB-only features from rendering in Madden dynasties and vice versa"
    - "Auto-export creates a JSON file silently on save without an OS dialog"
    - "Rivalry Dashboard shows momentum and key moments for existing rivals"
  artifacts:
    - path: "apps/desktop/src/lib/coaching-staff-service.ts"
      provides: "COMM-01 service"
    - path: "apps/desktop/src/lib/nil-service.ts"
      provides: "COMM-04 service"
    - path: "apps/desktop/src/lib/future-schedule-service.ts"
      provides: "COMM-05 service"
    - path: "apps/desktop/src/lib/player-link-service.ts"
      provides: "COMM-02 service"
    - path: "apps/desktop/src/lib/playoff-bracket.ts"
      provides: "COMM-03 logic"
    - path: "apps/desktop/src/lib/trade-calculator.ts"
      provides: "COMM-06 logic"
    - path: "apps/desktop/src/lib/auto-export-service.ts"
      provides: "COMM-08 auto-export"
    - path: "apps/desktop/src/pages/CoachingStaffPage.tsx"
      provides: "COMM-01 UI"
    - path: "apps/desktop/src/pages/NilLedgerPage.tsx"
      provides: "COMM-04 UI"
    - path: "apps/desktop/src/pages/FutureSchedulePage.tsx"
      provides: "COMM-05 UI"
    - path: "apps/desktop/src/pages/PlayoffSimulatorPage.tsx"
      provides: "COMM-03 UI"
    - path: "apps/desktop/src/pages/TradeCalculatorPage.tsx"
      provides: "COMM-06 UI"
    - path: "apps/desktop/src/pages/RecruitingComparisonPage.tsx"
      provides: "COMM-07 UI"
    - path: "apps/desktop/src/pages/RecordBookPage.tsx"
      provides: "COMM-09 UI"
  key_links:
    - from: "apps/desktop/src/App.tsx"
      to: "all 7 new page components"
      via: "PageContent switch cases"
      pattern: "coaching-staff|nil-ledger|future-schedule|playoff-simulator|trade-calculator|recruiting-comparison|record-book"
---

<objective>
Human verification checkpoint: confirm all 10 COMM features work correctly in the running app before Phase 12 is marked complete.

Purpose: Ensure every community feature is visually correct, sport guards work, and data persists as expected.
Output: Human approval that Phase 12 is complete.
</objective>

<execution_context>
@/Users/chanmoore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chanmoore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Final build verification</name>
  <files></files>
  <action>
Run the full desktop build and verify it exits 0:

```bash
cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1
```

If build fails, fix TypeScript errors before proceeding to human verification.

Verify all expected new files exist:
```bash
ls apps/desktop/src/lib/coaching-staff-service.ts apps/desktop/src/lib/nil-service.ts apps/desktop/src/lib/future-schedule-service.ts apps/desktop/src/lib/player-link-service.ts apps/desktop/src/lib/playoff-bracket.ts apps/desktop/src/lib/trade-calculator.ts apps/desktop/src/lib/auto-export-service.ts
ls apps/desktop/src/store/coaching-staff-store.ts apps/desktop/src/store/nil-store.ts apps/desktop/src/store/future-schedule-store.ts apps/desktop/src/store/player-link-store.ts
ls apps/desktop/src/pages/CoachingStaffPage.tsx apps/desktop/src/pages/NilLedgerPage.tsx apps/desktop/src/pages/FutureSchedulePage.tsx apps/desktop/src/pages/PlayoffSimulatorPage.tsx apps/desktop/src/pages/TradeCalculatorPage.tsx apps/desktop/src/pages/RecruitingComparisonPage.tsx apps/desktop/src/pages/RecordBookPage.tsx
```

Verify navigation-store.ts has all 7 new page entries:
```bash
grep -E "coaching-staff|nil-ledger|future-schedule|playoff-simulator|trade-calculator|recruiting-comparison|record-book" /Users/chanmoore/dev/dynasty-os/apps/desktop/src/store/navigation-store.ts
```

Verify App.tsx has all 7 new switch cases:
```bash
grep -E "coaching-staff|nil-ledger|future-schedule|playoff-simulator|trade-calculator|recruiting-comparison|record-book" /Users/chanmoore/dev/dynasty-os/apps/desktop/src/App.tsx
```
  </action>
  <verify>
    <automated>cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | tail -5</automated>
    <manual>All 19 new files exist; all 7 navigation entries present in navigation-store and App.tsx</manual>
  </verify>
  <done>Build exits 0; all artifact files present; all navigation entries registered</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Interactive walkthrough of all 10 COMM features</name>
  <files></files>
  <action>Human verifies all 10 COMM features in the running app using the checklist below.</action>
  <verify>
    <manual>All 10 features pass the step-by-step verification below — sport guards, data persistence, and UI rendering all confirmed.</manual>
  </verify>
  <done>User types "approved" after all 10 community features pass interactive verification.</done>
  <what-built>
    All 10 Phase 12 Community Features:
    - COMM-01: Coaching Staff (hire/fire/promote) — CoachingStaffPage
    - COMM-02: Player Links (CFB to NFL link section in PlayerProfilePage)
    - COMM-03: Playoff Simulator (CFB-gated, 4/8/12-team bracket)
    - COMM-04: NIL Ledger (CFB-gated, deal log + recharts spend charts)
    - COMM-05: Future Schedule (multi-year builder + bowl eligibility)
    - COMM-06: Trade Calculator (Madden-gated, position/rating/age/contract)
    - COMM-07: Recruiting Comparison (CFB-gated, multi-season bar chart)
    - COMM-08: Auto-Export (background JSON export toggle on Dashboard)
    - COMM-09: Record Book (full dynasty history, all seasons)
    - COMM-10: Rivalry Dashboard expanded (momentum score + key moments)
  </what-built>
  <how-to-verify>
    Run `pnpm --filter @dynasty-os/desktop tauri dev` and verify:

    **COMM-01 Coaching Staff:**
    1. Open command palette (Cmd+K), type "coaching staff", navigate
    2. Hire a coach (name, role, year, scheme notes) — verify toast success
    3. Fire the hired coach — verify they move to "Staff History" section
    4. Undo the fire or delete the coach — verify undo works

    **COMM-02 Player Links (CFB dynasty required):**
    1. Navigate to any player's profile page, scroll to bottom
    2. Verify "NFL/Madden Career Link" section is visible
    3. Enter linked player name + team — verify save works
    4. Switch to Madden dynasty — verify section is NOT shown

    **COMM-03 Playoff Simulator (CFB dynasty required):**
    1. Open command palette, navigate to "Playoff Simulator"
    2. Select 12-team bracket, enter team names, click "Start Bracket"
    3. Pick winners — verify bracket advances correctly
    4. Switch to Madden dynasty — verify page is empty/null

    **COMM-04 NIL Ledger (CFB dynasty required):**
    1. Open command palette, navigate to "NIL Ledger"
    2. Log an NIL deal for any player — verify it appears in the table
    3. Verify recharts bar charts render (spend by position, spend by year)
    4. Switch to Madden dynasty — verify page is empty/null

    **COMM-05 Future Schedule:**
    1. Open command palette, navigate to "Future Schedule"
    2. Add several games across different years — verify they appear grouped by year
    3. For CFB dynasty: verify bowl eligibility projection shows

    **COMM-06 Trade Calculator (Madden dynasty required):**
    1. Open command palette, navigate to "Trade Calculator"
    2. Enter QB, 92 OVR, age 25, 3 contract years — verify Elite grade
    3. Enter K, 72 OVR, age 35, 1 contract year — verify Low/Untradeable grade
    4. Switch to CFB dynasty — verify page is empty/null

    **COMM-07 Recruiting Comparison (CFB dynasty required):**
    1. Open command palette, navigate to "Recruiting Comparison"
    2. Select 2 seasons with recruiting classes — verify bar chart renders
    3. Verify season cards show grade + recruit counts

    **COMM-08 Auto-Export:**
    1. On Dashboard, find "Auto-export dynasty on save" toggle — enable it
    2. Make any data change (log a game, etc.)
    3. Verify no OS dialog appears
    4. Check ~/Library/Application Support/dynasty-os/exports/ for JSON file (macOS)

    **COMM-09 Record Book:**
    1. Open command palette, navigate to "Record Book"
    2. Verify all logged seasons appear in chronological order
    3. Verify W-L records and playoff/bowl results display

    **COMM-10 Rivalry Dashboard:**
    1. Navigate to Rivalry Tracker
    2. Open an existing rivalry — verify momentum score is shown
    3. Add a key moment (year + description) — verify it persists after navigating away and back
  </how-to-verify>
  <resume-signal>Type "approved" when all 10 features verified, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | tail -3
</verification>

<success_criteria>
- Build exits 0
- All 10 COMM requirements visually verified by user
- Sport guards working (CFB-only pages hidden for Madden, Madden-only for CFB)
- Auto-export writes silently without OS dialog
- Rivalry momentum + key moments working with localStorage persistence
- User types "approved"
</success_criteria>

<output>
After completion, create `.planning/phases/12-community-features/12-07-SUMMARY.md`
</output>
