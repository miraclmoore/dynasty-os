---
phase: 12-community-features
plan: "05"
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/desktop/src/pages/RecruitingComparisonPage.tsx
  - apps/desktop/src/pages/RecordBookPage.tsx
  - apps/desktop/src/store/navigation-store.ts
  - apps/desktop/src/App.tsx
  - apps/desktop/src/components/CommandPalette.tsx
autonomous: true
requirements:
  - COMM-07
  - COMM-09

must_haves:
  truths:
    - "CFB users can select 2-4 recruiting class seasons and compare them side-by-side in a recharts bar chart"
    - "Recruiting comparison shows class grade, star counts, and top recruits per selected season"
    - "Madden users see null on RecruitingComparisonPage (CFB guard)"
    - "Record Book shows all dynasty seasons in chronological order with record, stats, and awards"
    - "Record Book aggregates all existing DB data — no new tables or schemas needed"
  artifacts:
    - path: "apps/desktop/src/pages/RecruitingComparisonPage.tsx"
      provides: "CFB-gated multi-season recruiting class grade comparison with recharts bar chart"
      min_lines: 80
    - path: "apps/desktop/src/pages/RecordBookPage.tsx"
      provides: "All-dynasty historical season record book — direct db queries on mount"
      min_lines: 80
    - path: "apps/desktop/src/store/navigation-store.ts"
      provides: "recruiting-comparison + record-book pages and go actions"
      contains: "recruiting-comparison"
    - path: "apps/desktop/src/App.tsx"
      provides: "case 'recruiting-comparison' and case 'record-book'"
      contains: "recruiting-comparison"
  key_links:
    - from: "apps/desktop/src/pages/RecruitingComparisonPage.tsx"
      to: "apps/desktop/src/store/recruiting-store.ts"
      via: "useRecruitingStore for class data"
      pattern: "useRecruitingStore"
    - from: "apps/desktop/src/pages/RecordBookPage.tsx"
      to: "Dexie db"
      via: "direct db.seasons / db.games / db.playerSeasons queries on mount"
      pattern: "db\\.seasons|db\\.games|db\\.playerSeasons"
---

<objective>
Build two read-only view pages: Recruiting Comparison (CFB-gated, multi-season recharts bar chart) and Record Book (all-dynasty historical view using direct db queries — no store needed).

Purpose: CFB coaches need to compare recruiting classes to find trends; all coaches want a single-page historical record of their dynasty.
Output: RecruitingComparisonPage.tsx (uses existing recruitingClasses data + recharts), RecordBookPage.tsx (direct db queries, sport-agnostic).
</objective>

<execution_context>
@/Users/chanmoore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chanmoore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-community-features/12-RESEARCH.md

@apps/desktop/src/pages/CoachingResumePage.tsx
@apps/desktop/src/pages/RecruitingPage.tsx
@apps/desktop/src/store/navigation-store.ts
@apps/desktop/src/App.tsx
@apps/desktop/src/components/CommandPalette.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: RecruitingComparisonPage — multi-season side-by-side class comparison</name>
  <files>
    apps/desktop/src/pages/RecruitingComparisonPage.tsx
    apps/desktop/src/store/navigation-store.ts
    apps/desktop/src/App.tsx
    apps/desktop/src/components/CommandPalette.tsx
  </files>
  <action>
Create `apps/desktop/src/pages/RecruitingComparisonPage.tsx`:

- CFB sport guard at top: `if (!activeDynasty || activeDynasty.sport !== 'cfb') return null;`
- Data source: use `useRecruitingStore` to load recruiting classes (call `loadClasses(activeDynasty.id)` on mount if classes array is empty). Recruiting classes are from the existing `recruitingClasses` Dexie table — inspect RecruitingPage.tsx and useRecruitingStore to understand the data shape.
- "Rival programs" per RESEARCH.md pitfall note means comparing YOUR OWN seasons side-by-side — NOT cross-user comparison (local-first app)
- Season selector: multi-select checkboxes or toggle buttons for each season year in the dynasty — allow 2 to 4 seasons to be selected for comparison
- Comparison panel (shown when 1+ seasons selected):
  - recharts BarChart showing class grade score per season: `<BarChart data={selectedClasses}><XAxis dataKey="year" /><YAxis /><Bar dataKey="classGrade" fill="#3b82f6" /></BarChart>` — wrap in `<ResponsiveContainer width="100%" height={250}>`
  - Note: classGrade may be stored as a letter grade (A+, A, B, etc.) — convert to numeric (A+=100, A=95, A-=90, B+=85, ...) for chart; show letter grade in labels
  - Below chart: cards per selected season showing: Year, Class Grade, number of recruits, top 3 recruits by star rating (from class.recruits array or similar)
- Empty state (no recruiting classes): "No recruiting classes logged yet. Log classes on the Recruiting page."
- Tailwind: dark-mode consistent, blue accent for CFB recruiting data

Update navigation-store.ts:
- Add `'recruiting-comparison'` to Page union
- Add `goToRecruitingComparison: () => void` to NavigationActions + implement

Update App.tsx:
- Import RecruitingComparisonPage
- Add `case 'recruiting-comparison': return <RecruitingComparisonPage />;`

Update CommandPalette.tsx:
- CFB-gated entry: `{ id: 'nav-recruiting-comparison', label: 'Recruiting Comparison', description: 'Compare class grades by season', group: 'Navigation', action: () => goToRecruitingComparison() }`
  </action>
  <verify>
    <automated>cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | tail -5</automated>
    <manual>CFB dynasty: navigate to Recruiting Comparison, select 2 seasons, verify bar chart renders; Madden dynasty: page returns null</manual>
  </verify>
  <done>RecruitingComparisonPage renders CFB-only with season selector + recharts BarChart; navigation registered in navigation-store, App.tsx, CommandPalette; build exits 0</done>
</task>

<task type="auto">
  <name>Task 2: RecordBookPage — historical season record book</name>
  <files>
    apps/desktop/src/pages/RecordBookPage.tsx
    apps/desktop/src/store/navigation-store.ts
    apps/desktop/src/App.tsx
    apps/desktop/src/components/CommandPalette.tsx
  </files>
  <action>
Create `apps/desktop/src/pages/RecordBookPage.tsx`:

- Sport guard: NONE — record book is sport-agnostic
- Pattern: direct db queries on mount (like CoachingResumePage — read that file first to understand the pattern)
- On mount, run parallel db queries:
  ```typescript
  Promise.all([
    db.seasons.where('dynastyId').equals(activeDynasty.id).sortBy('year'),
    db.games.where('dynastyId').equals(activeDynasty.id).toArray(),
    db.playerSeasons.where('dynastyId').equals(activeDynasty.id).toArray(),
    db.players.where('dynastyId').equals(activeDynasty.id).toArray(),
  ]).then(([seasons, games, playerSeasons, players]) => {
    setRecordBook(buildRecordBook(seasons, games, playerSeasons, players));
  });
  ```
- `buildRecordBook` helper (local pure function in the page file):
  - For each season (sorted by year asc):
    - Season record: W-L (from season.wins + season.losses) or compute from games if needed
    - Conference record: confWins-confLosses
    - Conference placement and playoff result (from season fields)
    - Notable awards: (season.awards or similar — check actual Season type shape from core-types)
    - Top performer that season: player with most total stats (sum of stats Record values across playerSeasons for that season) — pick one stat key as "primary" based on sport (passing yards for QB, etc.) or just total a few
- Display: vertical scrollable list of season cards (each card ~100-150px tall) sorted oldest to newest
  - Season card: Year header + W-L record + Conference record (if available) + playoff/bowl result + conference standing + notable awards line
  - Separator between cards
- Print-friendly: add `@media print` consideration (no-print class on the page header nav, same pattern as ProgramTimelinePage)
- Loading state: spinner while db queries run
- Empty state (no seasons): "No seasons logged yet"

Update navigation-store.ts:
- Add `'record-book'` to Page union
- Add `goToRecordBook: () => void` to NavigationActions + implement

Update App.tsx:
- Import RecordBookPage
- Add `case 'record-book': return <RecordBookPage />;`

Update CommandPalette.tsx:
- Sport-agnostic entry: `{ id: 'nav-record-book', label: 'Record Book', description: 'Full dynasty history', group: 'Navigation', action: () => goToRecordBook() }`
  </action>
  <verify>
    <automated>cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | tail -5</automated>
    <manual>Navigate to Record Book; verify all logged seasons render in chronological order with W-L and playoff result; navigation routes correctly</manual>
  </verify>
  <done>RecordBookPage renders chronological season history with W-L records and awards; direct db queries work; navigation-store has record-book; App.tsx routes; CommandPalette entry present; build exits 0</done>
</task>

</tasks>

<verification>
cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | grep -E "(error|warning|✓|built)" | tail -10
</verification>

<success_criteria>
- RecruitingComparisonPage.tsx CFB-gated with recharts BarChart comparing class grades across seasons
- RecordBookPage.tsx sport-agnostic showing all dynasty seasons from direct db queries
- navigation-store.ts has recruiting-comparison + record-book + go actions
- App.tsx has both switch cases
- CommandPalette.tsx has both entries (recruiting-comparison CFB-gated, record-book sport-agnostic)
- pnpm build exits 0
</success_criteria>

<output>
After completion, create `.planning/phases/12-community-features/12-05-SUMMARY.md`
</output>
