---
phase: 11-qol-wins
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/desktop/src/pages/DashboardPage.tsx
  - apps/desktop/src/pages/ProgramTimelinePage.tsx
autonomous: true
requirements: [QOL-09, QOL-10]

must_haves:
  truths:
    - "Dashboard shows a season checklist widget listing annual tasks with checked/unchecked state"
    - "Checklist completion state persists across navigation within the session (via localStorage)"
    - "Checklist resets correctly when activeSeason changes (keyed by seasonId)"
    - "ProgramTimelinePage has a horizontal scrubber showing one pip per dynasty season"
    - "Clicking a scrubber pip scrolls the timeline to that year's node"
    - "Scrubber is not visible during printing (no-print class)"
  artifacts:
    - path: "apps/desktop/src/pages/DashboardPage.tsx"
      provides: "SeasonChecklist widget inline in DashboardPage active-season view"
    - path: "apps/desktop/src/pages/ProgramTimelinePage.tsx"
      provides: "Horizontal TimelineScrubber component inside ProgramTimelinePage"
  key_links:
    - from: "apps/desktop/src/pages/DashboardPage.tsx"
      to: "localStorage"
      via: "dynasty-os-checklist-{seasonId} key stores Record<string, boolean>"
      pattern: "dynasty-os-checklist-"
    - from: "apps/desktop/src/pages/ProgramTimelinePage.tsx"
      to: "nodes array"
      via: "one pip per node.season.year; scrollIntoView on pip click"
      pattern: "scrollIntoView"
---

<objective>
Build two new UI features: (1) a season checklist widget on the Dashboard that tracks annual tasks with localStorage persistence; (2) a horizontal timeline scrubber in ProgramTimelinePage that lets coaches jump to any dynasty year.

Purpose: QOL-09 surfaces the standard annual dynasty workflow in a checklist so nothing gets forgotten; QOL-10 makes long timelines (10+ seasons) navigable without endless scrolling. Both use existing data — no new services or stores needed.

Output: Inline SeasonChecklist widget in DashboardPage; TimelineScrubber component in ProgramTimelinePage.
</objective>

<execution_context>
@/Users/chanmoore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chanmoore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-qol-wins/11-RESEARCH.md
@apps/desktop/src/pages/DashboardPage.tsx
@apps/desktop/src/pages/ProgramTimelinePage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Season checklist widget on DashboardPage (QOL-09)</name>
  <files>
    apps/desktop/src/pages/DashboardPage.tsx
  </files>
  <action>
Add a season checklist widget to DashboardPage, shown only when `activeSeason` exists.

**Checklist tasks definition** (static array, defined outside the component):
```typescript
const CHECKLIST_TASKS = [
  { id: 'log-games', label: 'Log all games for the season' },
  { id: 'season-end', label: 'Record season end data (bowl/playoff/ranking)' },
  { id: 'narrative', label: 'Generate season recap narrative' },
  { id: 'player-stats', label: 'Update player stats for the season' },
  { id: 'recruiting', label: 'Log recruiting class (CFB)', cfbOnly: true },
  { id: 'nfl-draft', label: 'Log NFL draft class (CFB)', cfbOnly: true },
  { id: 'transfer-portal', label: 'Log transfer portal activity (CFB)', cfbOnly: true },
] as const;
```

**State management** — use a useState for the checked map, initialized from localStorage:

```typescript
const CHECKLIST_KEY = (seasonId: string) => `dynasty-os-checklist-${seasonId}`;

// Inside DashboardPage component, after activeSeason is available:
const [checklist, setChecklist] = useState<Record<string, boolean>>(() => {
  if (!activeSeason) return {};
  try {
    const stored = localStorage.getItem(CHECKLIST_KEY(activeSeason.id));
    return stored ? (JSON.parse(stored) as Record<string, boolean>) : {};
  } catch {
    return {};
  }
});
```

**Important:** Reset checklist when activeSeason changes (different season = different checklist):
```typescript
useEffect(() => {
  if (!activeSeason) return;
  try {
    const stored = localStorage.getItem(CHECKLIST_KEY(activeSeason.id));
    setChecklist(stored ? (JSON.parse(stored) as Record<string, boolean>) : {});
  } catch {
    setChecklist({});
  }
}, [activeSeason?.id]);
```

**Toggle handler:**
```typescript
const toggleTask = (taskId: string) => {
  if (!activeSeason) return;
  setChecklist((prev) => {
    const next = { ...prev, [taskId]: !prev[taskId] };
    localStorage.setItem(CHECKLIST_KEY(activeSeason.id), JSON.stringify(next));
    return next;
  });
};
```

**Widget JSX** — add as a card widget in the active season grid layout. Place it in the right column (1/3 width) below `StatHighlights` or as a new card:

```tsx
{/* Season Checklist widget */}
<div className="bg-gray-800 rounded-lg p-4">
  <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">
    Season Checklist
  </h3>
  <ul className="space-y-2">
    {CHECKLIST_TASKS.filter((task) =>
      !('cfbOnly' in task) || activeDynasty.sport === 'cfb'
    ).map((task) => (
      <li key={task.id}>
        <label className="flex items-start gap-2.5 cursor-pointer group">
          <input
            type="checkbox"
            checked={!!checklist[task.id]}
            onChange={() => toggleTask(task.id)}
            className="mt-0.5 w-4 h-4 rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-gray-900 cursor-pointer flex-shrink-0"
          />
          <span className={`text-sm transition-colors ${
            checklist[task.id]
              ? 'text-gray-500 line-through'
              : 'text-gray-300 group-hover:text-white'
          }`}>
            {task.label}
          </span>
        </label>
      </li>
    ))}
  </ul>
  {/* Completion counter */}
  {(() => {
    const applicable = CHECKLIST_TASKS.filter(
      (t) => !('cfbOnly' in t) || activeDynasty.sport === 'cfb'
    );
    const done = applicable.filter((t) => checklist[t.id]).length;
    return (
      <div className="mt-3 pt-3 border-t border-gray-700 text-xs text-gray-500">
        {done}/{applicable.length} complete
      </div>
    );
  })()}
</div>
```

Place this widget in the right-column `flex flex-col gap-4` div (where `WeeklySnapshot` and `StatHighlights` currently live), so it appears below `StatHighlights` without disrupting the existing 3-column layout.
  </action>
  <verify>
    <automated>cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | tail -20</automated>
    <manual>Open Dashboard with an active season — confirm checklist widget appears. Check "Log all games" — confirm it shows strikethrough. Navigate to Roster and back — confirm checkbox is still checked. Switch to a different season (if available) — confirm checklist resets.</manual>
  </verify>
  <done>DashboardPage shows SeasonChecklist widget with 7 tasks (CFB-gated for 3); checkbox state persists via localStorage keyed by seasonId; completion counter displays; TypeScript build clean.</done>
</task>

<task type="auto">
  <name>Task 2: Horizontal timeline scrubber in ProgramTimelinePage (QOL-10)</name>
  <files>
    apps/desktop/src/pages/ProgramTimelinePage.tsx
  </files>
  <action>
Add a horizontal scrubber component to ProgramTimelinePage. The `nodes: TimelineNode[]` array is already fetched and contains one entry per season (sorted by year ascending or descending — read the file to confirm order, then match the sort order for the scrubber pip sequence).

**Node refs for scrollIntoView:** Use a `useRef<Record<number, HTMLElement | null>>({})` to store a ref per year:
```typescript
const nodeRefs = useRef<Record<number, HTMLElement | null>>({});
```

On each timeline node div, attach the ref:
```tsx
<div
  key={node.season.id}
  ref={(el) => { nodeRefs.current[node.season.year] = el; }}
  className="timeline-node ..."
>
```

**Scrubber component (inline, above or below the nodes list):**

```tsx
{nodes.length > 1 && (
  <div className="sticky top-0 z-10 bg-gray-900/95 backdrop-blur-sm border-b border-gray-800 px-6 py-3 no-print">
    <div className="max-w-3xl mx-auto">
      <div className="flex items-center gap-1 overflow-x-auto pb-1">
        <span className="text-xs text-gray-500 mr-2 flex-shrink-0">Jump to:</span>
        {nodes.map((node) => (
          <button
            key={node.season.year}
            onClick={() => {
              const el = nodeRefs.current[node.season.year];
              el?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }}
            className="flex-shrink-0 px-2 py-0.5 text-xs text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors"
            title={`${node.season.year} season`}
          >
            {node.season.year}
          </button>
        ))}
      </div>
    </div>
  </div>
)}
```

Place the scrubber JSX immediately after the opening `<main>` tag (before the `<h1>`) or as a sticky bar inside the page, but below the header — so it sticks at the top of the content area as the user scrolls.

The scrubber uses `no-print` className so it's hidden during PDF export (consistent with existing no-print pattern in ProgramTimelinePage).

Note: If nodes are sorted ascending by year, map left-to-right will naturally show the oldest year first. If the page renders newest-first, reverse `nodes` for the scrubber only: `[...nodes].reverse().map(...)`. Read the file to confirm sort order before writing the JSX.

Only show the scrubber when `nodes.length > 1` — single-season timelines don't need navigation.
  </action>
  <verify>
    <automated>cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop build 2>&1 | tail -20</automated>
    <manual>Open ProgramTimelinePage for a dynasty with 3+ seasons — confirm year pills appear as a horizontal scrubber at the top of the content. Click the earliest year — confirm the page scrolls to that season node. Trigger window.print() — confirm the scrubber is hidden in the print preview.</manual>
  </verify>
  <done>ProgramTimelinePage has a sticky horizontal scrubber with one clickable year pill per season; clicking scrolls to the correct node; scrubber hidden during print; TypeScript build clean.</done>
</task>

</tasks>

<verification>
Run `pnpm --filter @dynasty-os/desktop build` — no errors.
Run `grep -n "dynasty-os-checklist" apps/desktop/src/pages/DashboardPage.tsx` — present.
Run `grep -n "scrollIntoView" apps/desktop/src/pages/ProgramTimelinePage.tsx` — present.
Run `grep -n "no-print" apps/desktop/src/pages/ProgramTimelinePage.tsx` — present on scrubber element.
</verification>

<success_criteria>
1. Dashboard season checklist shows annual tasks, CFB-gated tasks only appear for CFB dynasties.
2. Checklist state persists within the session via localStorage keyed by seasonId.
3. ProgramTimelinePage has a horizontal scrubber with one year pill per season.
4. Clicking a year pill scrolls the timeline to that season.
5. Scrubber is excluded from print/PDF output.
6. TypeScript build clean.
</success_criteria>

<output>
After completion, create `.planning/phases/11-qol-wins/11-05-SUMMARY.md`
</output>
