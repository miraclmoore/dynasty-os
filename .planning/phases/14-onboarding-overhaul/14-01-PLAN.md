---
phase: 14-onboarding-overhaul
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/desktop/src/components/TourOverlay.tsx
  - apps/desktop/src/components/SeasonAtGlance.tsx
  - apps/desktop/src/components/RecentActivity.tsx
  - apps/desktop/src/components/WeeklySnapshot.tsx
  - apps/desktop/src/components/StatHighlights.tsx
  - apps/desktop/src/components/QuickEntryHub.tsx
  - apps/desktop/src/components/GameLog.tsx
  - apps/desktop/src/pages/DashboardPage.tsx
  - apps/desktop/src/App.tsx
  - apps/desktop/src/pages/LauncherPage.tsx
autonomous: true
requirements:
  - ONBD-01
  - ONBD-02

must_haves:
  truths:
    - "After creating a new dynasty and landing on the dashboard, the onboarding tour launches automatically"
    - "The tour spotlights every required section: sidebar, Log Game, End Season, SeasonAtGlance, RecentActivity, WeeklySnapshot, StatHighlights, QuickEntryHub, Season Checklist, GameLog"
    - "Each spotlight step shows a popup with a title and explanatory text"
    - "User can dismiss the tour at any step and it marks itself complete in localStorage"
    - "The ? button in App.tsx re-opens the tour from the beginning at any time"
  artifacts:
    - path: "apps/desktop/src/components/TourOverlay.tsx"
      provides: "Full 12-step tour with data-tour-id targets for all required sections"
      contains: "STEPS array with 12 entries covering all ONBD-01 sections"
    - path: "apps/desktop/src/App.tsx"
      provides: "Auto-launch signal via localStorage key read on mount when activeDynasty first becomes set"
      contains: "ONBOARDING_STORAGE_KEY check to auto-open tour after new dynasty creation"
  key_links:
    - from: "apps/desktop/src/App.tsx"
      to: "apps/desktop/src/components/TourOverlay.tsx"
      via: "onboardingOpen state prop"
      pattern: "TourOverlay isOpen=\\{onboardingOpen\\}"
    - from: "apps/desktop/src/components/TourOverlay.tsx"
      to: "DOM elements with data-tour-id"
      via: "document.querySelector([data-tour-id=...])"
      pattern: "data-tour-id"
---

<objective>
Expand the onboarding tour to spotlight all 10 required dashboard sections (ONBD-01) and fix the auto-launch so it fires on the dashboard — not on the LauncherPage before navigation.

Purpose: New users arriving on the dashboard after dynasty creation get a guided tour of every major section. The tour currently only covers 4 spots and fires before the user lands on the dashboard, so the spotlight finds no elements.

Output: A complete 12-step tour (welcome + 10 section steps + closing) wired to auto-launch in App.tsx the first time a dynasty becomes active.
</objective>

<execution_context>
@/Users/chanmoore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chanmoore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

<interfaces>
<!-- Key types and contracts extracted from the codebase. Use these directly. -->

From apps/desktop/src/components/TourOverlay.tsx (current state):
```typescript
const STORAGE_KEY = 'dynasty-os-onboarding-v2';

interface TourStep {
  title: string;
  body: string;
  tip?: string | null;
  targetId: string | null; // data-tour-id value, or null for centered card
  page: 'dashboard' | 'roster';
}

// Current STEPS array has 6 entries:
// 0: Welcome (no target, dashboard)
// 1: Sidebar (tour-sidebar, dashboard)
// 2: Log Game (tour-log-game, dashboard)
// 3: End Season (tour-end-season, dashboard)
// 4: Roster (tour-roster, roster)
// 5: Closing (no target, dashboard)

export { STORAGE_KEY as ONBOARDING_STORAGE_KEY };
```

From apps/desktop/src/App.tsx (current state):
```typescript
// ? button already exists and wired:
const [onboardingOpen, setOnboardingOpen] = useState(false);
// TourOverlay at app level:
<TourOverlay isOpen={onboardingOpen} onClose={() => setOnboardingOpen(false)} />
// No auto-launch logic exists yet — needs to be added
```

From apps/desktop/src/pages/LauncherPage.tsx (current state — auto-launch fires here, wrong):
```typescript
// onCreated callback:
if (dynasties.length === 0 && !localStorage.getItem(ONBOARDING_STORAGE_KEY)) {
  setShowOnboarding(true);  // <-- fires BEFORE user reaches dashboard
}
// LauncherPage has its own TourOverlay that unmounts when dynasty activates
<TourOverlay isOpen={showOnboarding} onClose={() => setShowOnboarding(false)} />
```

Existing data-tour-id attributes in DashboardPage.tsx:
- `<aside data-tour-id="tour-sidebar" ...>`
- `<button data-tour-id="tour-log-game" ...>`
- `<button data-tour-id="tour-end-season" ...>`

In RosterPage.tsx:
- `<div data-tour-id="tour-roster" ...>`

Missing data-tour-id targets needed:
- tour-season-at-glance → SeasonAtGlance root div
- tour-recent-activity  → RecentActivity root div
- tour-weekly-snapshot  → WeeklySnapshot root div
- tour-stat-highlights  → StatHighlights root div
- tour-quick-entry      → QuickEntryHub root div
- tour-checklist        → Season Checklist section in DashboardPage
- tour-gamelog          → GameLog root div
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add data-tour-id attributes to all 7 missing dashboard sections</name>
  <files>
    apps/desktop/src/components/SeasonAtGlance.tsx
    apps/desktop/src/components/RecentActivity.tsx
    apps/desktop/src/components/WeeklySnapshot.tsx
    apps/desktop/src/components/StatHighlights.tsx
    apps/desktop/src/components/QuickEntryHub.tsx
    apps/desktop/src/components/GameLog.tsx
    apps/desktop/src/pages/DashboardPage.tsx
  </files>
  <action>
Add `data-tour-id` to the root element of each widget component and the checklist section in DashboardPage. Each value must exactly match what TourOverlay.STEPS will reference:

1. `SeasonAtGlance.tsx` line 17: change `<div className="bg-gray-800 rounded-lg p-5">` to `<div data-tour-id="tour-season-at-glance" className="bg-gray-800 rounded-lg p-5">`

2. `RecentActivity.tsx` line 16: change `<div className="bg-gray-800 rounded-lg p-5">` to `<div data-tour-id="tour-recent-activity" className="bg-gray-800 rounded-lg p-5">`

3. `WeeklySnapshot.tsx` line 46: change `<div className="bg-gray-800 rounded-lg p-5">` to `<div data-tour-id="tour-weekly-snapshot" className="bg-gray-800 rounded-lg p-5">`

4. `StatHighlights.tsx` line 74: change `<div className="bg-gray-800 rounded-lg p-5">` to `<div data-tour-id="tour-stat-highlights" className="bg-gray-800 rounded-lg p-5">`

5. `QuickEntryHub.tsx` — the QuickEntryHubInner component's root div (line 99): change `<div className="bg-gray-800/30 border border-gray-700/60 rounded-xl p-4">` to `<div data-tour-id="tour-quick-entry" className="bg-gray-800/30 border border-gray-700/60 rounded-xl p-4">`

6. `GameLog.tsx` line 132: change `<div className="bg-gray-800 rounded-lg p-5">` to `<div data-tour-id="tour-gamelog" className="bg-gray-800 rounded-lg p-5">`

7. `DashboardPage.tsx` — the Season Checklist section wrapper div: locate the `<div className="bg-gray-800 rounded-lg p-4">` that contains `<h3 ...>Season Checklist</h3>` and add `data-tour-id="tour-checklist"` to that div. It is around line 358.
  </action>
  <verify>grep -r "data-tour-id" /Users/chanmoore/dev/dynasty-os/apps/desktop/src/components/ /Users/chanmoore/dev/dynasty-os/apps/desktop/src/pages/DashboardPage.tsx | grep -v "TourOverlay" | wc -l
  # Should return at least 10 (3 existing + 7 new)</verify>
  <done>All 10 data-tour-id attributes present: tour-sidebar, tour-log-game, tour-end-season, tour-season-at-glance, tour-recent-activity, tour-weekly-snapshot, tour-stat-highlights, tour-quick-entry, tour-checklist, tour-gamelog. RosterPage still has tour-roster.</done>
</task>

<task type="auto">
  <name>Task 2: Expand TourOverlay STEPS and fix auto-launch wiring</name>
  <files>
    apps/desktop/src/components/TourOverlay.tsx
    apps/desktop/src/App.tsx
    apps/desktop/src/pages/LauncherPage.tsx
  </files>
  <action>
**Part A — Expand STEPS in TourOverlay.tsx:**

Replace the current 6-item STEPS array with a 12-item array covering all ONBD-01 sections. All steps use `page: 'dashboard'` except the roster step uses `page: 'roster'`. The roster step can be removed or kept minimal — but the requirement is only dashboard sections. Keep it for context but keep the required 10 dashboard sections. The full required STEPS array:

```typescript
const STEPS: TourStep[] = [
  {
    title: 'Welcome to Dynasty OS',
    body: "You're the head coach. This is your permanent record — every game, every player, every season, stored locally on your machine. Let's take a quick look around.",
    tip: null,
    targetId: null,
    page: 'dashboard',
  },
  {
    title: 'Your Command Center',
    body: 'The sidebar is your home base. Navigation to every feature lives here — season tools, roster, program history, and sport-specific extras like Recruiting or Franchise Sync.',
    tip: null,
    targetId: 'tour-sidebar',
    page: 'dashboard',
  },
  {
    title: 'Log Your First Game',
    body: 'After every game, hit "+ Log Game" to record the result. Your record updates automatically and feeds the season stats, activity feed, and AI recap.',
    tip: null,
    targetId: 'tour-log-game',
    page: 'dashboard',
  },
  {
    title: 'Close Out the Season',
    body: 'When the season is over, hit "End Season" to lock in your final ranking, bowl game or playoff result, and trigger the optional AI narrative recap.',
    tip: 'The Season Checklist on the dashboard walks you through every step before you close the year.',
    targetId: 'tour-end-season',
    page: 'dashboard',
  },
  {
    title: 'Quick Entry Hub',
    body: 'The Quick Entry Hub is your shortcut panel — log games, manage players, sync franchise data, and more from one place. Sections light up as you add data.',
    tip: null,
    targetId: 'tour-quick-entry',
    page: 'dashboard',
  },
  {
    title: 'Season at a Glance',
    body: 'Your live record, conference standing, and current ranking — updated automatically after every logged game. The scoreboard for your season.',
    tip: null,
    targetId: 'tour-season-at-glance',
    page: 'dashboard',
  },
  {
    title: 'Recent Activity',
    body: 'The last five game results at a glance — your win streak, scores, and momentum. A quick read on how the season is trending.',
    tip: null,
    targetId: 'tour-recent-activity',
    page: 'dashboard',
  },
  {
    title: 'Weekly Snapshot',
    body: 'Tells you what week you\'re on and surfaces the next opponent so you always know where you are in the schedule.',
    tip: null,
    targetId: 'tour-weekly-snapshot',
    page: 'dashboard',
  },
  {
    title: 'Stat Highlights',
    body: 'Running totals and season averages — points per game, total wins, scoring streaks — derived from your game log automatically.',
    tip: null,
    targetId: 'tour-stat-highlights',
    page: 'dashboard',
  },
  {
    title: 'Season Checklist',
    body: 'A guided checklist of annual tasks: log games, end the season, generate a recap, and more. Green dots appear when your data confirms the step is done.',
    tip: null,
    targetId: 'tour-checklist',
    page: 'dashboard',
  },
  {
    title: 'Game Log',
    body: 'Every game you\'ve logged lives here — score, result, week, notes, and an optional AI recap. Inline editing lets you correct scores without leaving the dashboard.',
    tip: null,
    targetId: 'tour-gamelog',
    page: 'dashboard',
  },
  {
    title: "You're the Coach Now",
    body: 'Your dynasty starts now. Use Cmd+K to jump anywhere instantly, or tap the ? button any time to replay this tour.',
    tip: 'CFB coaches unlock Recruiting, Transfer Portal, NFL Draft Tracker, and more from the sidebar.',
    targetId: null,
    page: 'dashboard',
  },
];
```

Also update the `useEffect` in TourOverlay — remove the `page: 'roster'` navigation branch since no steps go to roster anymore. The navigation logic should only navigate to dashboard when `currentStep.page === 'dashboard' && currentPage !== 'dashboard'`. Remove the roster branch entirely.

**Part B — Fix auto-launch in App.tsx:**

The auto-launch currently fires in LauncherPage (which unmounts when activeDynasty is set). Move it to App.tsx. Add a new `useEffect` that watches `activeDynasty`:

```typescript
// Auto-open tour for newly created dynasties
useEffect(() => {
  if (!activeDynasty) return;
  // Check if this is a fresh dynasty creation by looking for the pending flag
  const pendingKey = 'dynasty-os-onboarding-pending';
  if (localStorage.getItem(pendingKey) === 'true') {
    localStorage.removeItem(pendingKey);
    setOnboardingOpen(true);
  }
}, [activeDynasty?.id]);
```

The pending flag needs to be set when a dynasty is created. Update LauncherPage.tsx `onCreated` callback:

```typescript
onCreated={() => {
  // Set pending flag — App.tsx watches activeDynasty and opens tour when it sees this
  localStorage.setItem('dynasty-os-onboarding-pending', 'true');
}}
```

Remove the old LauncherPage `showOnboarding` state, the `ONBOARDING_STORAGE_KEY` import, and the `<TourOverlay isOpen={showOnboarding} ...>` from LauncherPage entirely. LauncherPage no longer manages the tour.

**Important:** The `ONBOARDING_STORAGE_KEY` ('dynasty-os-onboarding-v2') is still written by TourOverlay.dismiss() and can still be checked by App.tsx if desired, but the pending flag approach is simpler and more reliable. Do NOT add an ONBOARDING_STORAGE_KEY guard to the new pending-flag check in App.tsx — users who have already done the tour should still be able to re-trigger via the ? button, and the pending flag is only set on new dynasty creation.
  </action>
  <verify>
    <automated>cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop tsc --noEmit 2>&1 | tail -20</automated>
  </verify>
  <done>
    - TourOverlay.STEPS has 12 entries covering all ONBD-01 sections
    - All targetId values match the data-tour-id attributes added in Task 1
    - LauncherPage no longer imports or renders TourOverlay
    - App.tsx has a useEffect that opens the tour when dynasty-os-onboarding-pending flag is set
    - TypeScript compiles clean (no new errors)
  </done>
</task>

</tasks>

<verification>
Run a TypeScript build check and grep verification:

```bash
cd /Users/chanmoore/dev/dynasty-os && pnpm --filter @dynasty-os/desktop tsc --noEmit
grep -r "data-tour-id" apps/desktop/src/ | grep -v "TourOverlay\|\.tsx:" | wc -l
grep -c "targetId:" apps/desktop/src/components/TourOverlay.tsx
```

Expected: TypeScript passes clean, 10+ data-tour-id usages, 12 targetId entries in STEPS.
</verification>

<success_criteria>
1. TourOverlay.STEPS has 12 entries — all 10 required ONBD-01 sections plus welcome and closing
2. Every STEPS entry's targetId has a matching data-tour-id attribute in the DOM
3. App.tsx opens the tour when 'dynasty-os-onboarding-pending' localStorage flag is set on activeDynasty change
4. LauncherPage no longer manages TourOverlay state
5. TypeScript compiles without new errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-onboarding-overhaul/14-01-SUMMARY.md`
</output>
