---
phase: 02-core-loop
plan: "02"
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - apps/desktop/src/pages/DashboardPage.tsx
  - apps/desktop/src/components/SeasonAtGlance.tsx
  - apps/desktop/src/components/RecentActivity.tsx
  - apps/desktop/src/components/WeeklySnapshot.tsx
autonomous: true

must_haves:
  truths:
    - "User sees current overall record (W-L) prominently on the dashboard"
    - "User sees current conference record on the dashboard"
    - "User sees latest ranking (if set) on the dashboard"
    - "User sees a feed of recent game results on the dashboard"
    - "User sees upcoming opponent or next week number on the dashboard"
    - "User sees ranking movement context (e.g., entered week ranked #5)"
    - "Dashboard loads season and game data on mount when activeDynasty is set"
  artifacts:
    - path: "apps/desktop/src/pages/DashboardPage.tsx"
      provides: "Full dashboard layout with widget grid, season initialization, and action buttons"
      min_lines: 80
    - path: "apps/desktop/src/components/SeasonAtGlance.tsx"
      provides: "Record, conference record, ranking display widget"
      min_lines: 30
    - path: "apps/desktop/src/components/RecentActivity.tsx"
      provides: "Last 5 games feed with opponent, score, result"
      min_lines: 30
    - path: "apps/desktop/src/components/WeeklySnapshot.tsx"
      provides: "Current week view: record, ranking, upcoming opponent"
      min_lines: 25
  key_links:
    - from: "apps/desktop/src/pages/DashboardPage.tsx"
      to: "apps/desktop/src/store/season-store.ts"
      via: "useSeasonStore to load/display active season"
      pattern: "useSeasonStore"
    - from: "apps/desktop/src/pages/DashboardPage.tsx"
      to: "apps/desktop/src/store/game-store.ts"
      via: "useGameStore to load/display games"
      pattern: "useGameStore"
    - from: "apps/desktop/src/components/SeasonAtGlance.tsx"
      to: "Season type"
      via: "receives Season props to display record"
      pattern: "wins.*losses.*confWins.*confLosses"
---

<objective>
Build the dashboard layout and read-only widgets that show the user's current season state —
record, ranking, recent games, and weekly context.

Purpose: This is the primary screen users see after selecting a dynasty. It must surface the most
important information at a glance without requiring clicks or navigation.

Output: Rewritten DashboardPage with widget grid, plus 3 widget components displaying real data
from the season and game stores.
</objective>

<execution_context>
@/Users/chanmoore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chanmoore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

# Data layer from Plan 02-01
@apps/desktop/src/store/season-store.ts
@apps/desktop/src/store/game-store.ts
@apps/desktop/src/lib/season-service.ts
@apps/desktop/src/lib/game-service.ts

# Existing dashboard to replace
@apps/desktop/src/pages/DashboardPage.tsx

# Existing components to keep
@apps/desktop/src/components/DynastySwitcher.tsx

# Store pattern
@apps/desktop/src/store/dynasty-store.ts

# Types
@packages/core-types/src/season.ts
@packages/core-types/src/game.ts
@packages/core-types/src/dynasty.ts

# Sport config for team data
@packages/sport-configs/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite DashboardPage with grid layout and season initialization</name>
  <files>apps/desktop/src/pages/DashboardPage.tsx</files>
  <action>
    Completely rewrite DashboardPage.tsx. Keep the existing header with dynasty name, sport badge,
    and DynastySwitcher. Replace the placeholder content below the header with a real dashboard.

    **Season initialization logic:**
    On mount (useEffect), when activeDynasty is set:
    1. Call `useSeasonStore.getState().loadSeasons(activeDynasty.id)`
    2. If no seasons exist, show a "Start Your First Season" prompt with a button that calls
       `useSeasonStore.getState().createSeason(activeDynasty.id, activeDynasty.currentYear)`
    3. When activeSeason exists, call `useGameStore.getState().loadGames(activeSeason.id)`

    **Layout structure (below the dynasty summary bar):**
    Use a responsive grid: `grid grid-cols-1 lg:grid-cols-3 gap-6` inside `max-w-6xl mx-auto px-6 py-6`.
    Widen from max-w-5xl to max-w-6xl to accommodate the grid.

    Left column (lg:col-span-2):
    - SeasonAtGlance widget (record, conf record, ranking)
    - RecentActivity widget (last 5 games)

    Right column (lg:col-span-1):
    - WeeklySnapshot widget (this week's context)
    - Action buttons section:
      - "Log Game" button (primary, blue-600 bg) — sets `logGameOpen` state to true
      - "End Season" button (secondary, gray-700 bg) — sets `seasonEndOpen` state to true
      - These buttons set boolean state but the modals themselves are NOT created in this plan.
        Conditionally render: `{logGameOpen && <div>...</div>}` as a placeholder that just shows
        "Game entry modal coming next" — this will be replaced in Plan 02-03.

    **Empty/zero states:**
    When no games logged yet, SeasonAtGlance shows "0-0" record with "(No games logged yet)" subtitle.
    RecentActivity shows "No games logged yet — use Log Game to get started."
    WeeklySnapshot shows "Week 1" as default.

    **Data flow:**
    DashboardPage reads from useSeasonStore (activeSeason, seasons) and useGameStore (games).
    Pass data as props to child widgets. Do NOT have widgets subscribe to stores directly —
    keep DashboardPage as the single subscriber to avoid unnecessary re-renders.

    **Styling:** Dark theme consistent with existing: bg-gray-900 base, bg-gray-800 card backgrounds,
    border-gray-700 borders, text-white primary, text-gray-400 secondary text.
    Cards: rounded-lg, p-4 or p-5, subtle shadow if desired.
  </action>
  <verify>
    Run `pnpm exec tsc --noEmit -p apps/desktop/tsconfig.json` — no type errors.
    Run `pnpm run dev` from apps/desktop, navigate to a dynasty — dashboard should render grid layout.
  </verify>
  <done>
    DashboardPage shows grid layout with SeasonAtGlance, RecentActivity, WeeklySnapshot widgets.
    Season auto-initializes on first visit. Log Game and End Season buttons are visible.
    Empty states display when no games are logged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SeasonAtGlance, RecentActivity, and WeeklySnapshot widgets</name>
  <files>
    apps/desktop/src/components/SeasonAtGlance.tsx
    apps/desktop/src/components/RecentActivity.tsx
    apps/desktop/src/components/WeeklySnapshot.tsx
  </files>
  <action>
    Create `apps/desktop/src/components/SeasonAtGlance.tsx`:

    Props: `{ season: Season | null }`
    Display:
    - Large record: "{wins}-{losses}" in text-3xl font-bold
    - If season has confWins or confLosses > 0: show "({confWins}-{confLosses} conf)" below in text-sm text-gray-400
    - If season.finalRanking is set: show "#{finalRanking}" badge in amber/gold color
    - Card wrapper: bg-gray-800 rounded-lg p-5
    - Title: "Season at a Glance" in text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3

    Create `apps/desktop/src/components/RecentActivity.tsx`:

    Props: `{ games: Game[] }` (expects last 5 games, already sorted by recency)
    Display:
    - List of game results, each as a row:
      - Result badge: "W" (green-500 bg) or "L" (red-500 bg) or "T" (gray-500 bg) — small rounded pill
      - "vs" or "@" prefix based on homeAway (home = "vs", away = "@", neutral = "vs" at neutral site)
      - Opponent name
      - Score: "{teamScore}-{opponentScore}"
      - Week number in text-gray-500
      - If opponentRanking is set: show "#{opponentRanking}" before opponent name
    - Empty state: gray text "No games logged yet"
    - Card wrapper: bg-gray-800 rounded-lg p-5
    - Title: "Recent Results" in same style as SeasonAtGlance title

    Create `apps/desktop/src/components/WeeklySnapshot.tsx`:

    Props: `{ season: Season | null; games: Game[]; }`
    Display:
    - Determine current week: if games exist, max(game.week) + 1; else 1
    - Show "Week {currentWeek}" as heading
    - Show current record: "{wins}-{losses}"
    - If the last game logged has a result, show it as "Last: {result} vs {opponent} {score}"
    - If season.finalRanking is set: "Current Ranking: #{finalRanking}"
    - Determine upcoming opponent: look for a game with week === currentWeek. If found, show
      "Next: vs/@ {opponent}". If not found, show "Next opponent: TBD"
      Note: In practice, upcoming games won't be pre-logged, so "TBD" is the default. This widget
      is primarily about showing current week context and last result.
    - Card wrapper: bg-gray-800 rounded-lg p-5
    - Title: "This Week"

    All components: import types from @dynasty-os/core-types. Use React.FC or function component style
    matching the existing codebase (function component with explicit return, not arrow functions).
  </action>
  <verify>
    Run `pnpm exec tsc --noEmit -p apps/desktop/tsconfig.json` — no type errors.
    Visually verify in browser: dashboard shows three widget cards with appropriate empty states.
  </verify>
  <done>
    Three widget components render real season/game data.
    SeasonAtGlance shows record and ranking.
    RecentActivity shows last 5 game results with W/L badges.
    WeeklySnapshot shows current week number, last result, and upcoming context.
    All display appropriate empty states when no data exists.
  </done>
</task>

</tasks>

<verification>
1. `pnpm exec tsc --noEmit -p apps/desktop/tsconfig.json` — zero errors
2. `pnpm run build` from repo root succeeds
3. Dashboard renders grid layout with 3 widget cards
4. Empty states display when no games are logged
5. "Log Game" and "End Season" buttons are visible on dashboard
6. Season auto-creates on first dashboard visit for a dynasty
7. DashboardPage subscribes to both useSeasonStore and useGameStore
</verification>

<success_criteria>
- DashboardPage is no longer a placeholder — shows real widget grid
- DASH-01 satisfied: record, ranking, and recent activity visible on dashboard
- DASH-03 partially satisfied: stat highlights area present (StatHighlights widget added in Plan 02-04)
- SEAS-05 partially satisfied: weekly snapshot shows record, ranking, upcoming context
- Season initializes automatically on first dynasty visit
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-loop/02-02-SUMMARY.md`
</output>
